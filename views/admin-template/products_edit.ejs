<!-- Begin Page Content -->
<div class="container-fluid">

  <!-- Page Heading -->
  <h1 class="h3 mb-2 text-gray-800" style="line-height: 1.3;"> <%= product.title %> </h1>


  <div class="row">

    <div class="col-12 p-2">
      <div class="row">
        <div class="col-6 col-md-3 p-2">
          <div class="card rounded bg-white p-4">
            <img src="/product_images/<%=product?.PID %>1.jpg" class="img-fluid" alt="">
          </div>
        </div>
        <div class="col-6 col-md-3 p-2">
          <div class="card rounded bg-white p-4">
            <img src="/product_images/<%=product?.PID %>2.jpg" class="img-fluid" alt="">
          </div>
        </div>
        <div class="col-6 col-md-3 p-2">
          <div class="card rounded bg-white p-4">
            <img src="/product_images/<%=product?.PID %>3.jpg" class="img-fluid" alt="">
          </div>
        </div>
        <div class="col-6 col-md-3 p-2">
          <div class="card rounded bg-white p-4">
            <img src="/product_images/<%=product?.PID %>4.jpg" class="img-fluid" alt="">
          </div>
        </div>
      </div>
    </div>

    <div class="col-12 p-2">
      <div class="card rounded bg-white py-2 pt-3 px-4">
        <h5 style="line-height: 1.3;"><%=product?.title?product.title:''%></h5>
        <p><%=product?.description?product.description:''%></p>
        <p style="text-transform:capitalize;">Category : <%= product?.category %> </p>
        <p>Price : <%=product?.price?product.price+' Rs':''%></p>
        <p>Offer : - <%=product?.offer?''+product.offer+' Rs / Pcs':''%></p>
        <p>Amount need to pay : <%=product?.price?product.price - product.offer+' Rs / Pcs':''%></p>
      </div>
    </div>

    <div class="col-12 p-2">
      <div class="row">

        <div class="col-md-8 p-2">
          <div class="rounded card bg-white py-1 px-2">
            <div class="card-body">
              <h4 class="card-title">Todays view count</h4>
              <canvas id="productDailyView"></canvas>
            </div>
          </div>
        </div>

        <div class="col-md-4 p-2">
          <div class="rounded card bg-white h-100">
            <div class="card-body p-3">
              <h4 class="card-title">Views This week</h4>
              <canvas id="productWeekViews" style="position: relative; height:110vh; width:80vw"></canvas>
            </div>
          </div>
        </div>

        <div class="col-md-8 p-2">
          <div class="rounded card bg-white">
            <div class="card-body p-3">
              <h4 class="card-title">Impressions today</h4>
              <canvas id="productDayImpressions"></canvas>
            </div>
          </div>
        </div>

      </div>
    </div>


  </div>

  <script>
    (async function() {
      try {
        const reslut = await fetch('/api/products?analytics-pid=<%=product?.PID%>', {
          method: 'GET'
        });
        const res = await reslut.json();

        const dayxValues = [];
        for (let i = 0; i <= 23; i++) {
          if (i >= 12) dayxValues.push(i == 12 ? 12 + " pm" : i - 12 + " pm");
          else dayxValues.push(i + " am");
        };

        const weekxValues = [];
        for (let i = 1; i <= 7; i++) {
          weekxValues.push(i);
        };

        const dayOptions = {
          legend: {
            display: false
          },
          scales: {
            yAxes: [{
              ticks: {
                min: 0,
                precision: 0
              }
            }],
          },
          plugins: {
            filler: {
              propagate: true
            }
          }
        };

        const dayColor = [
          'rgba(255, 99, 132, 0.2)',
          'rgba(54, 162, 235, 0.2)',
          'rgba(255, 206, 86, 0.2)',
          'rgba(75, 192, 192, 0.2)',
          'rgba(153, 102, 255, 0.2)',
          'rgba(255, 159, 64, 0.2)',
          'rgba(255, 99, 132, 0.2)',
          'rgba(54, 162, 235, 0.2)',
          'rgba(255, 206, 86, 0.2)',
          'rgba(75, 192, 192, 0.2)',
          'rgba(153, 102, 255, 0.2)',
          'rgba(255, 159, 64, 0.2)',
          'rgba(255, 99, 132, 0.2)',
          'rgba(54, 162, 235, 0.2)',
          'rgba(255, 206, 86, 0.2)',
          'rgba(75, 192, 192, 0.2)',
          'rgba(153, 102, 255, 0.2)',
          'rgba(255, 159, 64, 0.2)',
          'rgba(255, 99, 132, 0.2)',
          'rgba(54, 162, 235, 0.2)',
          'rgba(255, 206, 86, 0.2)',
          'rgba(75, 192, 192, 0.2)',
          'rgba(153, 102, 255, 0.2)',
          'rgba(255, 159, 64, 0.2)'
        ];

        let yValuesA = [];
        let yValuesB = [];
        let yValuesC = [];

        for (let i = 0; i < 24; i++) {
          let outputA = '';
          let outputB = '';
          for (let j = 0; j < 24; j++) {
            if (res['analytics-pid'].day_views[j]) {
              if (res['analytics-pid'].day_views[j].hour == i) {
                outputA = Number(res['analytics-pid'].day_views[j].count);
                break;
              } else {
                outputA = 0;
              };
            };
          };
          for (let j = 0; j < 24; j++) {
            if (res['analytics-pid'].day_impressions[j]) {
              if (res['analytics-pid'].day_impressions[j].hour == i) {
                outputB = Number(res['analytics-pid'].day_impressions[j].count);
                break;
              } else {
                outputB = 0;
              };
            };
          };
          yValuesA.push(outputA);
          yValuesC.push(outputB);
        };

        for (let i = 0; i < 7; i++) {
          let output = '';
          for (let j = 0; j < 7; j++) {
            if (res['analytics-pid'].week_views[j]) {
              if (res['analytics-pid'].week_views[j].day == i) {
                output = Number(res['analytics-pid'].week_views[j].count);
                break;
              } else {
                output = 0;
              };
            };
          };
          yValuesB.push(output);
        };

        new Chart("productDailyView", {
          type: "bar",
          data: {
            labels: dayxValues,
            datasets: [{
              lineTension: 0,
              backgroundColor: dayColor,
              borderColor: dayColor,
              fill: true,
              borderWidth: 1,
              data: yValuesA
            }]
          },
          options: dayOptions
        });

        new Chart("productWeekViews", {
          type: "line",
          data: {
            labels: weekxValues,
            datasets: [{
              lineTension: 0,
              backgroundColor: dayColor,
              borderColor: dayColor,
              fill: true,
              borderWidth: 2,
              data: yValuesB
            }]
          },
          options: dayOptions
        });

        new Chart("productDayImpressions", {
          type: "line",
          data: {
            labels: dayxValues,
            datasets: [{
              lineTension: 0,
              backgroundColor: dayColor,
              borderColor: dayColor,
              fill: true,
              borderWidth: 2,
              data: yValuesC
            }]
          },
          options: dayOptions
        });
      } catch (error) {
        console.warn('Error => ', error);
      };

    }());
  </script>


  <!-- DataTales Example -->
  <!-- <div class="card mb-4">
    <div class="card-header py-3 bg-white d-flex justify-content-between">
      <h6 class="m-0 font-weight-bold text-primary" style="text-transform: capitalize;">
        Edit product
      </h6>
      <span style="text-transform: capitalize;">
        <%= product.creationTime %>
      </span>
    </div>
    <div class="card-body">

      <div class="input-cont">
        <label for="title">Title * <span></span></label>
        <textarea type="text" name="Title" id="titleInput" autocomplete="off" placeholder="Product title"><%=product?.title?product.title:''%></textarea>
      </div>

      <div class="input-cont">
        <label for="description">Description * <span></span></label>
        <textarea type="text" name="description" id="descriptionInput" autocomplete="off" placeholder="Breaf description"><%=product?.description?product.description:''%></textarea>
      </div>

      <div class="input-cont horz">
        <div class="input-cont">
          <label for="price">Price * <span></span></label>
          <input type="text" name="price" id="priceInput" placeholder="Price" value="<%=product?.price?product.price:''%>" autocomplete="off">
        </div>
        <div class="input-cont">
          <label for="quantity">Quantity * <span></span></label>
          <input type="text" name="quantity" id="quantityInput" autocomplete="off" placeholder="Quantity" value="<%=product?.stock?product.stock:''%>">
        </div>
      </div>

      <div class="input-cont horz">
        <div class="input-cont">
          <label for="discount">Discount (optional) <span></span></label>
          <input type="text" name="offer" id="offerInput" autocomplete="off" placeholder="Discount amount" value="<%=product?.offer?product.offer:''%>">
        </div>
        <div class="input-cont">
          <label for="category">Catogery * <span></span></label>
          <select name="category" id="categoryInput">
            <option value="<%=product?.category?product.category:''%>">
              <%=product?.category?product.category:'--Select--'%>
            </option>
            <% category.forEach((element,index,array)=>{ %>

            <option value="<%= element.category %> ">
              <%= element.category %>
            </option>

            <% }); %>
          </select>
        </div>
      </div>

      <div class="input-cont horz">

        <div class="input-cont img card">
          <% let id = 'imgA_DISP'; let idA='imgA'; let idB = 'img1'%>
          <div class="card-header">
            <label for="<%=idA%>">Feature image <span></span></label>
          </div>
          <div class="card-body d-flex justify-content-between">
            <div class="img-from-cont">
              <img id="<%=id%>" src="/product_images/<%=product.PID %>1.jpg" class="img-cont" alt="">
               <span class="choose">Select image</span> -->
  <!-- </div>
            <div class="edit-action-cont ml-3">
              <p class="mb-0">Tools</p>
              <div class="icons">
                <button class="editAction" disabled onclick="window['<%=id%>'].setDragMode('move');">
                  <img src="/icn/move.svg" aria-disabled="true" alt="">
                </button>
                <button class="editAction" disabled onclick="window['<%=id%>'].setDragMode('crop');">
                  <img src="/icn/plus.svg" aria-disabled="true" alt="">
                </button>
                <button class="editAction" disabled onclick="window['<%=id%>'].move(0,-10)">
                  <img src="/icn/up.svg" aria-disabled="true" alt="">
                </button>
                <button class="editAction" disabled onclick="window['<%=id%>'].move(0,10)">
                  <img src="/icn/down.svg" aria-disabled="true" alt="">
                </button>
                <button class="editAction" disabled onclick="window['<%=id%>'].move(-10,0)">
                  <img src="/icn/left.svg" aria-disabled="true" alt="">
                </button>
                <button class="editAction" disabled onclick="window['<%=id%>'].move(10,0)">
                  <img src="/icn/right.svg" aria-disabled="true" alt="">
                </button>
                <button class="editAction" disabled onclick="window['<%=id%>'].rotate(-45)">
                  <img src="/icn/rotate-left.svg" aria-disabled="true" alt="">
                </button>
                <button class="editAction" disabled onclick="window['<%=id%>'].rotate(45)">
                  <img src="/icn/rotate-right.svg" aria-disabled="true" alt="">
                </button>
                <button class="editAction" disabled onclick="flipImageXA(this,'<%=id%>')">
                  <img src="/icn/horz-flip.svg" aria-disabled="true" alt="">
                </button>
                <button class="editAction" disabled onclick="flipImageYA(this,'<%=id%>')">
                  <img src="/icn/vert-flip.svg" aria-disabled="true" alt="">
                </button>
                <button class="editAction" disabled onclick="window['<%=id%>'].zoom(0.1)">
                  <img src="/icn/zoom-in.svg" aria-disabled="true" alt="">
                </button>
                <button class="editAction" disabled onclick="window['<%=id%>'].zoom(-0.1)">
                  <img src="/icn/zoom-out.svg" aria-disabled="true" alt="">
                </button>
                <button class="editAction" disabled onclick="window['<%=id%>'].reset()">
                  <img src="/icn/reset.svg" aria-disabled="true" alt="">
                </button>
              </div>
            </div>
          </div>
          <div class="card-footer">
            <button class="btn btn-primary rounded ml-0" onclick="cropperJS('<%=id%>',this, '<%=idB%>')">Edit image</button>
            <button class="btn btn-primary rounded" onclick="selectImage('<%=id%>',this, '<%=idB%>')">Select image</button>
            <input type="file" accept="image/jpeg" name="<%=idA%>" id="<%=idA%>" hidden>
          </div>
        </div>

        <div class="input-cont img card">
          <% id = 'imgB_DISP'; idA='imgB'; idB = 'img2'%>
          <div class="card-header">
            <label for="<%=idA%>">Feature image <span></span></label>
          </div>
          <div class="card-body d-flex justify-content-between">
            <div class="img-from-cont">
              <img id="<%=id%>" src="/product_images/<%=product.PID %>2.jpg" class="img-cont" alt=""> -->
  <!-- <span class="choose">Select image</span> -->
  <!-- </div>
            <div class="edit-action-cont ml-3">
              <p class="mb-0">Tools</p>
              <div class="icons">
                <button class="editAction" disabled onclick="window['<%=id%>'].setDragMode('move');">
                  <img src="/icn/move.svg" aria-disabled="true" alt="">
                </button>
                <button class="editAction" disabled onclick="window['<%=id%>'].setDragMode('crop');">
                  <img src="/icn/plus.svg" aria-disabled="true" alt="">
                </button>
                <button class="editAction" disabled onclick="window['<%=id%>'].move(0,-10)">
                  <img src="/icn/up.svg" aria-disabled="true" alt="">
                </button>
                <button class="editAction" disabled onclick="window['<%=id%>'].move(0,10)">
                  <img src="/icn/down.svg" aria-disabled="true" alt="">
                </button>
                <button class="editAction" disabled onclick="window['<%=id%>'].move(-10,0)">
                  <img src="/icn/left.svg" aria-disabled="true" alt="">
                </button>
                <button class="editAction" disabled onclick="window['<%=id%>'].move(10,0)">
                  <img src="/icn/right.svg" aria-disabled="true" alt="">
                </button>
                <button class="editAction" disabled onclick="window['<%=id%>'].rotate(-45)">
                  <img src="/icn/rotate-left.svg" aria-disabled="true" alt="">
                </button>
                <button class="editAction" disabled onclick="window['<%=id%>'].rotate(45)">
                  <img src="/icn/rotate-right.svg" aria-disabled="true" alt="">
                </button>
                <button class="editAction" disabled onclick="flipImageXA(this,'<%=id%>')">
                  <img src="/icn/horz-flip.svg" aria-disabled="true" alt="">
                </button>
                <button class="editAction" disabled onclick="flipImageYA(this,'<%=id%>')">
                  <img src="/icn/vert-flip.svg" aria-disabled="true" alt="">
                </button>
                <button class="editAction" disabled onclick="window['<%=id%>'].zoom(0.1)">
                  <img src="/icn/zoom-in.svg" aria-disabled="true" alt="">
                </button>
                <button class="editAction" disabled onclick="window['<%=id%>'].zoom(-0.1)">
                  <img src="/icn/zoom-out.svg" aria-disabled="true" alt="">
                </button>
                <button class="editAction" disabled onclick="window['<%=id%>'].reset()">
                  <img src="/icn/reset.svg" aria-disabled="true" alt="">
                </button>
              </div>
            </div>
          </div>
          <div class="card-footer">
            <button class="btn btn-primary rounded ml-0" onclick="cropperJS('<%=id%>',this, '<%=idB%>')">Edit image</button>
            <button class="btn btn-primary rounded" onclick="selectImage('<%=id%>',this, '<%=idB%>')">Select image</button>
            <input type="file" accept="image/jpeg" name="<%=idA%>" id="<%=idA%>" hidden>
          </div>
        </div>

        <div class="input-cont img card">
          <% id = 'imgC_DISP'; idA='imgC'; idB = 'img3'%>
          <div class="card-header">
            <label for="<%=idA%>">Feature image <span></span></label>
          </div>
          <div class="card-body d-flex justify-content-between">
            <div class="img-from-cont">
              <img id="<%=id%>" src="/product_images/<%=product.PID %>3.jpg" class="img-cont" alt=""> -->
  <!-- <span class="choose">Select image</span> -->
  <!-- <!-- </div>
            <div class="edit-action-cont ml-3">
              <p class="mb-0">Tools</p>
              <div class="icons">
                <button class="editAction" disabled onclick="window['<%=id%>'].setDragMode('move');">
                  <img src="/icn/move.svg" aria-disabled="true" alt="">
                </button>
                <button class="editAction" disabled onclick="window['<%=id%>'].setDragMode('crop');">
                  <img src="/icn/plus.svg" aria-disabled="true" alt="">
                </button>
                <button class="editAction" disabled onclick="window['<%=id%>'].move(0,-10)">
                  <img src="/icn/up.svg" aria-disabled="true" alt="">
                </button>
                <button class="editAction" disabled onclick="window['<%=id%>'].move(0,10)">
                  <img src="/icn/down.svg" aria-disabled="true" alt="">
                </button>
                <button class="editAction" disabled onclick="window['<%=id%>'].move(-10,0)">
                  <img src="/icn/left.svg" aria-disabled="true" alt="">
                </button>
                <button class="editAction" disabled onclick="window['<%=id%>'].move(10,0)">
                  <img src="/icn/right.svg" aria-disabled="true" alt="">
                </button>
                <button class="editAction" disabled onclick="window['<%=id%>'].rotate(-45)">
                  <img src="/icn/rotate-left.svg" aria-disabled="true" alt="">
                </button>
                <button class="editAction" disabled onclick="window['<%=id%>'].rotate(45)">
                  <img src="/icn/rotate-right.svg" aria-disabled="true" alt="">
                </button>
                <button class="editAction" disabled onclick="flipImageXA(this,'<%=id%>')">
                  <img src="/icn/horz-flip.svg" aria-disabled="true" alt="">
                </button>
                <button class="editAction" disabled onclick="flipImageYA(this,'<%=id%>')">
                  <img src="/icn/vert-flip.svg" aria-disabled="true" alt="">
                </button>
                <button class="editAction" disabled onclick="window['<%=id%>'].zoom(0.1)">
                  <img src="/icn/zoom-in.svg" aria-disabled="true" alt="">
                </button>
                <button class="editAction" disabled onclick="window['<%=id%>'].zoom(-0.1)">
                  <img src="/icn/zoom-out.svg" aria-disabled="true" alt="">
                </button>
                <button class="editAction" disabled onclick="window['<%=id%>'].reset()">
                  <img src="/icn/reset.svg" aria-disabled="true" alt="">
                </button>
              </div>
            </div>
          </div>
          <div class="card-footer">
            <button class="btn btn-primary rounded ml-0" onclick="cropperJS('<%=id%>',this, '<%=idB%>')">Edit image</button>
            <button class="btn btn-primary rounded" onclick="selectImage('<%=id%>',this, '<%=idB%>')">Select image</button>
            <input type="file" accept="image/jpeg" name="<%=idA%>" id="<%=idA%>" hidden>
          </div>
        </div>

        <div class="input-cont img card">
          <% id = 'imgD_DISP'; idA='imgD'; idB = 'img4'%>
          <div class="card-header">
            <label for="<%=idA%>">Feature image <span></span></label>
          </div>
          <div class="card-body d-flex justify-content-between">
            <div class="img-from-cont">
              <img id="<%=id%>" src="/product_images/<%=product.PID %>4.jpg" class="img-cont" alt="">
              <span class="choose">Select image</span> -->
  <!-- </div>
            <div class="edit-action-cont ml-3">
              <p class="mb-0">Tools</p>
              <div class="icons">
                <button class="editAction" disabled onclick="window['<%=id%>'].setDragMode('move');">
                  <img src="/icn/move.svg" aria-disabled="true" alt="">
                </button>
                <button class="editAction" disabled onclick="window['<%=id%>'].setDragMode('crop');">
                  <img src="/icn/plus.svg" aria-disabled="true" alt="">
                </button>
                <button class="editAction" disabled onclick="window['<%=id%>'].move(0,-10)">
                  <img src="/icn/up.svg" aria-disabled="true" alt="">
                </button>
                <button class="editAction" disabled onclick="window['<%=id%>'].move(0,10)">
                  <img src="/icn/down.svg" aria-disabled="true" alt="">
                </button>
                <button class="editAction" disabled onclick="window['<%=id%>'].move(-10,0)">
                  <img src="/icn/left.svg" aria-disabled="true" alt="">
                </button>
                <button class="editAction" disabled onclick="window['<%=id%>'].move(10,0)">
                  <img src="/icn/right.svg" aria-disabled="true" alt="">
                </button>
                <button class="editAction" disabled onclick="window['<%=id%>'].rotate(-45)">
                  <img src="/icn/rotate-left.svg" aria-disabled="true" alt="">
                </button>
                <button class="editAction" disabled onclick="window['<%=id%>'].rotate(45)">
                  <img src="/icn/rotate-right.svg" aria-disabled="true" alt="">
                </button>
                <button class="editAction" disabled onclick="flipImageXA(this,'<%=id%>')">
                  <img src="/icn/horz-flip.svg" aria-disabled="true" alt="">
                </button>
                <button class="editAction" disabled onclick="flipImageYA(this,'<%=id%>')">
                  <img src="/icn/vert-flip.svg" aria-disabled="true" alt="">
                </button>
                <button class="editAction" disabled onclick="window['<%=id%>'].zoom(0.1)">
                  <img src="/icn/zoom-in.svg" aria-disabled="true" alt="">
                </button>
                <button class="editAction" disabled onclick="window['<%=id%>'].zoom(-0.1)">
                  <img src="/icn/zoom-out.svg" aria-disabled="true" alt="">
                </button>
                <button class="editAction" disabled onclick="window['<%=id%>'].reset()">
                  <img src="/icn/reset.svg" aria-disabled="true" alt="">
                </button>
              </div>
            </div>
          </div>
          <div class="card-footer">
            <button class="btn btn-primary rounded ml-0" onclick="cropperJS('<%=id%>',this, '<%=idB%>')">Edit image</button>
            <button class="btn btn-primary rounded" onclick="selectImage('<%=id%>',this, '<%=idB%>')">Select image</button>
            <input type="file" accept="image/jpeg" name="<%=idA%>" id="<%=idA%>" hidden>
          </div>
        </div>

      </div> 

      <div id="disp_state" style="padding: 10px 15px; display: none; text-transform: capitalize; background-color: rgb(255, 206, 206); box-sizing: border-box; margin: 10px; color: black;" class="mt-2 rounded">
        -
      </div>

      <div class="btn-cont">
        <button class="btn" onclick="updateUserData('<%=product.PID%>')">Submit</button>
        <button class="btn btn-danger bg-danger" onclick="confirmDeletion('<%=product.PID%>')">Delete
          Product</button>
      </div> <br>
    </div>
  </div>

  <script src="/js/admin/editProducts.js"></script>


</div> -->
  <!-- /.container-fluid -->